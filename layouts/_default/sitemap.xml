{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<!-- Custom sitemap template with isPublished filter -->
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- range .Data.Pages }}
  {{- $shouldInclude := true }}
  {{- if .IsPage }}
    {{- $isPublished := .Params.isPublished | default .Params.ispublished | default true }}
    {{- if eq $isPublished false }}
      {{- $shouldInclude = false }}
    {{- end }}
  {{- else if .IsNode }}
    {{- if eq .Kind "term" }}
      {{- $hasPublished := false }}
      {{- range .Pages }}
        {{- $isPublished := .Params.isPublished | default .Params.ispublished | default true }}
        {{- if ne $isPublished false }}
          {{- $hasPublished = true }}
        {{- end }}
      {{- end }}
      {{- if not $hasPublished }}
        {{- $shouldInclude = false }}
      {{- end }}
    {{- end }}
  {{- end }}
  {{- if $shouldInclude }}
  <url>
    <loc>{{ .Permalink }}</loc>
    {{- if not .Lastmod.IsZero }}
    <lastmod>{{ .Lastmod.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</lastmod>
    {{- end }}
  </url>
  {{- end }}
  {{- end }}
</urlset>
